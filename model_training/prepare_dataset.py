# prepare_dataset.py

import json
import pandas as pd
from datasets import Dataset


def create_training_data():
    """
    Создай файл training_data.json с парами контекст-вопрос
    Формат:
    [
        {"context": "текст на русском", "question": "вопрос на русском"},
        ...
    ]
    """

    # ✅ ИСПРАВЛЕНО: убрал дублирование
    training_examples = [
        # История
        {
            "context": "Python — это высокоуровневый язык программирования, созданный Гвидо ван Россумом в 1991 году.",
            "question": "Кто создал язык программирования Python?"
        },
        {
            "context": "Москва является столицей России и крупнейшим городом страны с населением более 12 миллионов человек.",
            "question": "Какой город является столицей России?"
        },
        {
            "context": "FastAPI - это современный веб-фреймворк для создания API с Python 3.7+, основанный на стандартных подсказках типов Python.",
            "question": "Что такое FastAPI?"
        },
        {
            "context": "Первая мировая война началась в 1914 году и закончилась в 1918 году, в ней участвовало более 30 стран.",
            "question": "Когда началась Первая мировая война?"
        },
        {
            "context": "Юрий Гагарин стал первым человеком в космосе 12 апреля 1961 года на корабле Восток-1.",
            "question": "Кто был первым человеком в космосе?"
        },
        {
            "context": "Александр Пушкин родился в Москве 6 июня 1799 года и считается величайшим русским поэтом.",
            "question": "Где родился Александр Пушкин?"
        },
        {
            "context": "Санкт-Петербург был основан Петром I в 1703 году на берегу Финского залива.",
            "question": "Кто основал Санкт-Петербург?"
        },
        {
            "context": "Бородинское сражение произошло 7 сентября 1812 года во время Отечественной войны с Наполеоном.",
            "question": "Когда произошло Бородинское сражение?"
        },
        {
            "context": "Октябрьская революция в России началась 25 октября 1917 года по старому стилю.",
            "question": "Когда началась Октябрьская революция?"
        },
        {
            "context": "СССР был образован 30 декабря 1922 года и просуществовал до декабря 1991 года.",
            "question": "Когда был образован СССР?"
        },

        # Наука и технологии
        {
            "context": "Дмитрий Менделеев открыл Периодический закон химических элементов в 1869 году.",
            "question": "Кто открыл Периодический закон?"
        },
        {
            "context": "Альберт Эйнштейн разработал теорию относительности в начале XX века.",
            "question": "Кто разработал теорию относительности?"
        },
        {
            "context": "Интернет появился в результате проекта ARPANET в 1969 году в США.",
            "question": "Когда появился интернет?"
        },
        {
            "context": "Первый искусственный спутник Земли был запущен Советским Союзом 4 октября 1957 года.",
            "question": "Когда был запущен первый спутник?"
        },
        {
            "context": "ДНК была открыта Джеймсом Уотсоном и Фрэнсисом Криком в 1953 году.",
            "question": "Кто открыл структуру ДНК?"
        },
        {
            "context": "Электричество было открыто и изучено многими учеными, но Бенджамин Франклин провел знаменитый эксперимент с воздушным змеем в 1752 году.",
            "question": "Кто провел эксперимент с воздушным змеем?"
        },
        {
            "context": "Александр Флеминг случайно открыл пенициллин в 1928 году, что стало революцией в медицине.",
            "question": "Кто открыл пенициллин?"
        },
        {
            "context": "Квантовая физика была разработана в начале XX века группой ученых, включая Макса Планка и Нильса Бора.",
            "question": "Когда была разработана квантовая физика?"
        },
        {
            "context": "Мария Кюри стала первой женщиной, получившей Нобелевскую премию, за исследования радиоактивности.",
            "question": "Кто была первой женщиной с Нобелевской премией?"
        },
        {
            "context": "Томас Эдисон изобрел электрическую лампочку в 1879 году.",
            "question": "Кто изобрел электрическую лампочку?"
        },

        # Остальные 180 примеров из предыдущего ответа...
        # (все остальные примеры по географии, литературе, искусству и т.д.)
        # Скопируй их из моего предыдущего ответа

        # География
        {
            "context": "Эверест - самая высокая гора в мире, её высота составляет 8848 метров над уровнем моря.",
            "question": "Какая самая высокая гора в мире?"
        },
        {
            "context": "Байкал - самое глубокое озеро на планете, его максимальная глубина достигает 1642 метров.",
            "question": "Какое самое глубокое озеро в мире?"
        },
        # ... (добавь все остальные примеры)
    ]

    # Сохрани в JSON
    with open('training_data.json', 'w', encoding='utf-8') as f:
        json.dump(training_examples, f, ensure_ascii=False, indent=2)

    print(f"✅ Создано {len(training_examples)} примеров")


def prepare_dataset_for_t5():
    """Подготовка датасета в формат T5"""

    # Загрузи данные
    with open('training_data.json', 'r', encoding='utf-8') as f:
        data = json.load(f)

    # Преобразуй в формат T5
    processed_data = []
    for item in data:
        # Входной текст: "generate question: [контекст]"
        input_text = f"generate question: {item['context']}"
        # Целевой текст: вопрос
        target_text = item['question']

        processed_data.append({
            'input_text': input_text,
            'target_text': target_text
        })

    # Создай Dataset
    df = pd.DataFrame(processed_data)
    dataset = Dataset.from_pandas(df)

    # Разделение на train/validation (80/20)
    dataset = dataset.train_test_split(test_size=0.2, seed=42)

    return dataset


if __name__ == "__main__":
    create_training_data()
    dataset = prepare_dataset_for_t5()
    print(f"Train size: {len(dataset['train'])}")
    print(f"Validation size: {len(dataset['test'])}")
    print(dataset['train'][0])
